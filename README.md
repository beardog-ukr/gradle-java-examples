This repo contains few examples of gradle java projects. Hope it will help people who has just started to learn java and gradle.

# Contents

So, here we have
- *alfa* a simplest helloworld java application. Uses two packages, creates a jar file
- *bravo* same as *alfa*, but some resources for the application should be generated with additional gradle target.
- *charlie* shows how to use gradle plugins from source
- *delta* a java classes with unit testing. Junit module on filesystem, tests are performed as some gradle target.
- *echo* a java classes with unit testing. Junit module on filesystem, one special application will be compiled to run tests.
- *foxtrot* same as *alfa* but JUnit module comes from maven-central repo.

# Examples

Most of the examples follow [Maven project structure](http://http://maven.apache.org/guides/introduction/introduction-to-the-standard-directory-layout.html).

## Alfa

`alfa` is a very simple application. It has two packages defined in `src/main/java/alfaApp` and `src/main/java/conversation`. So the code in *MainApp.java* file shows how to use classes from different files or packages.

We added a *jar* task to the `gradle.build` file to create a jar file
```
sourceCompatibility = 1.5
version = '1.0'
jar {
    manifest {
        attributes 'Implementation-Title': 'Alfa speaking app',
                   'Implementation-Version': version,
                   'Main-Class': 'alfaApp.MainApp'
    }
}
```

To build this project you should cd to `alfa` folder and type
```
: gradle build
```

*gradle* will create a jar file in `build/libs/alfa-1.0.jar`.  You can run it as
```
:java -jar ./build/libs/alfa-1.0.jar
```

More examples to read:
* [iRomin](http://rominirani.com/2014/07/28/gradle-tutorial-part-2-java-projects/)
* [mkyong](http://www.mkyong.com/gradle/gradle-create-a-jar-file-with-dependencies/)
* [Kainulainen](http://www.petrikainulainen.net/programming/gradle/getting-started-with-gradle-our-first-java-project/)
* From gradle [docs](https://docs.gradle.org/current/userguide/tutorial_java_projects.html) (see section *44.2.6. Summary*), also [here](https://docs.gradle.org/current/userguide/java_plugin.html#useJavaPlugin)

More info:
* About [project structure](http://cyber-fall.blogspot.com/2011/10/manual-project-projects.html)
* About JAR files: [oracle docs](https://docs.oracle.com/javase/tutorial/deployment/jar/basicsindex.html), some other [article](http://javarevisited.blogspot.com/2012/03/how-to-create-and-execute-jar-file-in.html), [so](http://stackoverflow.com/questions/21721119/creating-runnable-jar-with-gradle)


One more thing: the word `alfa` has no errors, it's first item in [NATO phonetic alphabet](https://en.wikipedia.org/wiki/NATO_phonetic_alphabet)

## Bravo

`bravo` example is same as `alfa`, but with few new features:
 - it uses third party compotent for logging ([Logback](http://logback.qos.ch/)).
 - gradle will take `logback` from [maven central](http://search.maven.org/) repository and it will be embedded into final jar files
 - we'll generate two jar files with different logging configurations

### bravo gradle file

First, we add we add two additional targets to th `build.gradle`. One looks like
```
task debugJar(type: Jar) {
  manifest {
        attributes 'Implementation-Title': 'Bravo Example',
        	'Implementation-Version': version,
        	'Main-Class': 'bravoApp.MainApp'
  }

  baseName = project.name + '-debug'
  rename('logback-debug.xml', 'logback.xml')

  with jar
}
```
By default *logback* loads its configuration from special file named [logback.xml](http://logback.qos.ch/manual/configuration.html#auto_configuration) and this file has to be added into final jar. We have two files with different configurations in `src/main/resouses`.

In order to use *logback* in our project we'll have to add following code to `build.gradle`:
```
//Get dependencies from Maven central repository
repositories {
    mavenCentral()
}

//Project dependencies
dependencies {
	compile 'ch.qos.logback:logback-classic:1.1.2'
}
```
This will ensure that project will be compiled correctly, but we need to add all logback classes to the final jar file


More examples to read:
* [mkyong](http://www.mkyong.com/gradle/gradle-create-a-jar-file-with-dependencies/)
* [iRomin](http://rominirani.com/2014/07/28/gradle-tutorial-part-2-java-projects/)

## Charlie

`charlie` example uses a special configuration file (embedded into jar) . This config file should be generated by [node.js](http://nodejs.org) script and we'll use a custom written gradle plugin to do it.

`charlie` example is a bit strange, because it's based on real-life project, and that project had its own reasons to use some strange desigions.
 - the application uses configuration file in [INI format](https://en.wikipedia.org/wiki/INI_file) (and this INI file will be embedded into jar)
 - but in sources the settings are stored in [YAML](https://en.wikipedia.org/wiki/YAML)
 - and the javasrcript([node.js](http://nodejs.org/)) is used to convert YAML to INI. That's the weirdest part but it's a good opportunity to show how to use custom written gradle plugins to perform nodejs tasks.

Following work will be done:

1. Create temporary folder where the INI file will be generated. Maven standard does not define such case, but [Java Ranch](http://www.javaranch.com/build_standards.jsp) recommends to use `build/gen-src/` folder for such purposes
2. Copy the geterator script (*settingsGenerator.js*) and YAML source (*config.yaml*) to this folder
3. The `settingsGenerator.js` requires some third party nodejs modules. We keep this modules archived in `src/main/resources/settings/node_modules.tar.gz`. Now we have to extract this archive to the temporary folder.
4. Then we have to execute `settingsGenerator.js` script with node and it will generate us the "settings.ini" file
5. Finally, we need to compile java code and pack it into JAR file with together with *settings.ini*.

For this demo project I've used sources from [srs/gradle-node-plugin](https://github.com/srs/gradle-node-plugin) repo. Note, the parent project may change a lot since that time.
`gradle` [requires](https://docs.gradle.org/current/userguide/custom_plugins.html) that sources of custom plugins should appear in `buildSrc` folder.

## Delta

*delta* example is similar to *charlie* but simpler. The `src/main/bash/settingsGenerator.sh` script will generate config file using `config.yaml`. However it does not require any additional third party utilities.

So the `delta` example shows:
 - how to [run bash script](https://docs.gradle.org/current/dsl/org.gradle.api.tasks.Exec.html) from gradle
 - how to implement the [generator task](https://docs.gradle.org/current/userguide/more_about_tasks.html#generatorTask)

The idea of the generator task is thas in usual gradle task we specify some files or folders:
```
  ext.srcFile = file('src/main/bash/settings/config.yaml')
  ext.destDir = new File(buildDir, '/gen-src/settings')

  inputs.file srcFile
  outputs.dir destDir
```
and gradle will try to watch for this folders. During next build the task will be performed only if the files were changed.

Really project could be build without this lines, but in that case the `generateSettings` task will be called every time.